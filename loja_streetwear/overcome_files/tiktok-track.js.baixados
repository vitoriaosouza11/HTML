(()=>{"use strict";var t;!function(t){t.FACEBOOK="facebook",t.TIKTOK="tiktok",t.GOOGLE="google",t.SNAPCHAT="snapchat"}(t||(t={}));var n;!function(t){t.CUSTOM_PIXEL="custom-pixel",t.SCRIPT_TAG="script-tag",t.THEME_APP_EXTENSION="theme-app-extension",t.APP_PIXEL="app-pixel"}(n||(n={}));var e=function(t,n,e,o){return new(e||(e=Promise))((function(i,c){function r(t){try{u(o.next(t))}catch(t){c(t)}}function a(t){try{u(o.throw(t))}catch(t){c(t)}}function u(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,a)}u((o=o.apply(t,n||[])).next())}))};var o=function(t,n,e,o){return new(e||(e=Promise))((function(i,c){function r(t){try{u(o.next(t))}catch(t){c(t)}}function a(t){try{u(o.throw(t))}catch(t){c(t)}}function u(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,a)}u((o=o.apply(t,n||[])).next())}))};const i=t=>o(void 0,void 0,void 0,(function*(){return crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t)).then((t=>{let n=[],e=new DataView(t);for(let t=0;t<e.byteLength;t+=4)n.push(("00000000"+e.getUint32(t).toString(16)).slice(-8));return n.join("")}))}));var c;!function(t){t.STANDARD_SHOPIFY="standard_shopify",t.CUSTOM_APPOINTMENT="custom_appointment",t.UNKNOWN="unknown"}(c||(c={}));const r=(t,e)=>{return r=void 0,a=void 0,d=function*(){const r=(()=>{switch((()=>{const t=window.Shopify.checkout;if(t){if(t.order_id)return c.STANDARD_SHOPIFY}else if(-1!==window.location.href.indexOf("appointment_id"))return c.CUSTOM_APPOINTMENT;return c.UNKNOWN})()){case c.STANDARD_SHOPIFY:return{event_id:window.Shopify.checkout.order_id,eventData:window.Shopify.checkout.line_items.map((t=>{return{content_id:`${t.product_id}`,content_name:t.title,content_type:"product",content_description:"",content_image:(e=(null==t?void 0:t.image_url)||"",e.startsWith("//cdn.shopify.com")?"https:"+e:""),price:(n=t.price,n.includes(",")&&(n=","===n[n.length-3]?n.replace(".","").replace(",","."):n.replace(",","")),n),quantity:t.quantity};var n,e})),currency:window.Shopify.checkout.currency,value:window.Shopify.checkout.total_price,quantity:window.Shopify.checkout.line_items.reduce(((t,n)=>t+n.quantity),0)};case c.CUSTOM_APPOINTMENT:return(()=>{const t=new URLSearchParams(window.location.search),n=t.get("eventID")||"",e=t.get("content_name")||"",o=t.get("appointment_id")||"",i=t.get("value")||"";return{event_id:n,eventData:[{content_id:o,content_description:"",content_name:e,content_type:"product",content_image:"",price:i,quantity:1}],currency:t.get("currency")||"",value:Number(i),quantity:1}})();default:return null}})();var a,u,d,s;if(yield(a=void 0,u=void 0,d=void 0,s=function*(){return{id:null,email:null,phoneNumber:null}},new(d||(d=Promise))((function(t,n){function e(t){try{i(s.next(t))}catch(t){n(t)}}function o(t){try{i(s.throw(t))}catch(t){n(t)}}function i(n){var i;n.done?t(n.value):(i=n.value,i instanceof d?i:new d((function(t){t(i)}))).then(e,o)}i((s=s.apply(a,u||[])).next())}))),!r)return;const{event_id:l,eventData:f,currency:v,value:p,quantity:h}=r;if(yield o(void 0,void 0,void 0,(function*(){var t,n,e,c,r,a;const u=null===(n=null===(t=window.Shopify)||void 0===t?void 0:t.checkout)||void 0===n?void 0:n.customer_id,d=null===(c=null===(e=window.Shopify)||void 0===e?void 0:e.checkout)||void 0===c?void 0:c.phone,s=null===(a=null===(r=window.Shopify)||void 0===r?void 0:r.checkout)||void 0===a?void 0:a.email,l=yield(f=s,o(void 0,void 0,void 0,(function*(){if(!f)return"";const t=f.trim().toLowerCase();return yield i(t)})));var f;const v=yield(p=d,o(void 0,void 0,void 0,(function*(){if(!p)return"";const t=p.trim().toLowerCase();return yield i(t)})));var p;const h=yield(t=>o(void 0,void 0,void 0,(function*(){if(!t)return"";const n=t.toString();return yield i(n)})))(u);window.ttq.identify({sha256_email:l,sha256_phone_number:v,sha256_external_id:h})})),((t,n,e,o,i)=>{window.ttq.track("CompletePayment",{contents:n.map((t=>({content_id:t.content_id,content_name:t.content_name,content_type:t.content_type,price:t.price,quantity:t.quantity}))),currency:e,value:o,quantity:i},{event_id:t})})(l,f,v,p,h),e)try{yield function(t,e,o,i,c){return fetch("https://events-v2.adtrace.ai/event",{method:"POST",headers:{"Content-Type":"application/json","Shopify-Domain":e,"User-Agent":navigator.userAgent,"X-Adtrace-Origin":n.SCRIPT_TAG},body:JSON.stringify({event_id:t,event_name:"CompletePayment",contents:Array.isArray(o)?o:[o],currency:i,totalPrice:c,event_context:{page:{url:window.location.href,referrer:document.referrer}},cookie:document.cookie})})}(l,t,f,v,p)}catch(t){console.log(t)}},new((u=void 0)||(u=Promise))((function(t,n){function e(t){try{i(d.next(t))}catch(t){n(t)}}function o(t){try{i(d.throw(t))}catch(t){n(t)}}function i(n){var i;n.done?t(n.value):(i=n.value,i instanceof u?i:new u((function(t){t(i)}))).then(e,o)}i((d=d.apply(r,a||[])).next())}));var r,a,u,d};!function(){var n,o,i,c;n=this,o=void 0,c=function*(){window.adtApps=window.adtApps||[],window.adtApps.push("tiktok");const n=window.location.href,o=(t=>{const n=-1!==t.indexOf("thank_you"),e=-1!==t.indexOf("orders");return n||e})(n);if(!o)return;const i=window.Shopify.shop;var c,a,u,d,s;if(i)if(c=yield((t,n)=>e(void 0,void 0,void 0,(function*(){const o=yield((t,n)=>e(void 0,void 0,void 0,(function*(){return(yield fetch(`https://events.adtrace.ai/checkout?shop=${t}&platform=${n}`)).json()})))(t,n),{serverSideApiEnabled:i,pixelCodes:c}=o;return{serverSideApiEnabled:i,pixelCodes:c}})))(i,t.TIKTOK),a=void 0,u=void 0,s=function*(){!function(t,n,e){t.TiktokAnalyticsObject=e;var o=t[e]=t[e]||[];o.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],o.setAndDefer=function(t,n){t[n]=function(){t.push([n].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<o.methods.length;i++)o.setAndDefer(o,o.methods[i]);o.instance=function(t){for(var n=o._i[t]||[],e=0;e<o.methods.length;e++)o.setAndDefer(n,o.methods[e]);return n},o.load=function(t,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";o._i=o._i||{},o._i[t]=[],o._i[t]._u=i,o._t=o._t||{},o._t[t]=+new Date,o._o=o._o||{},o._o[t]=n||{};var c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src=i+"?sdkid="+t+"&lib="+e;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(c,r)},c.pixelCodes.forEach((function(t){o.load(t)}))}(window,document,"ttq")},new((d=void 0)||(d=Promise))((function(t,n){function e(t){try{i(s.next(t))}catch(t){n(t)}}function o(t){try{i(s.throw(t))}catch(t){n(t)}}function i(n){var i;n.done?t(n.value):(i=n.value,i instanceof d?i:new d((function(t){t(i)}))).then(e,o)}i((s=s.apply(a,u||[])).next())})),-1!==n.indexOf("thank_you")){const t="tiktok"===window.adtApps[0];yield r(i,t)}else(n=>{switch(n){case t.FACEBOOK:window.fbq("track","PageView");break;case t.TIKTOK:window.ttq.page();break;case t.GOOGLE:break;case t.SNAPCHAT:window.snaptr("track","PAGE_VIEW")}})(t.TIKTOK)},new((i=void 0)||(i=Promise))((function(t,e){function r(t){try{u(c.next(t))}catch(t){e(t)}}function a(t){try{u(c.throw(t))}catch(t){e(t)}}function u(n){var e;n.done?t(n.value):(e=n.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}u((c=c.apply(n,o||[])).next())}))}()})();