(()=>{"use strict";var t=function(){!function(t,e,n){t.TiktokAnalyticsObject=n;var o=t[n]=t[n]||[];o.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],o.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var r=0;r<o.methods.length;r++)o.setAndDefer(o,o.methods[r]);o.instance=function(t){for(var e=o._i[t]||[],n=0;n<o.methods.length;n++)o.setAndDefer(e,o.methods[n]);return e},o.load=function(t,e){var r="https://analytics.tiktok.com/i18n/pixel/events.js";o._i=o._i||{},o._i[t]=[],o._i[t]._u=r,o._t=o._t||{},o._t[t]=+new Date,o._o=o._o||{},o._o[t]=e||{};var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=r+"?sdkid="+t+"&lib="+n;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(i,c)},document.querySelectorAll("[data-adttp]").forEach((function(t){o.load(t.dataset.adttp)}))}(window,document,"ttq")},e=function(){var t;console.log("Extracting RSI checkout data");var e,n=null===(t=window._rsi)||void 0===t?void 0:t.cart;return console.log("cart",n),n?n.items.map((function(t){return{id:"".concat(t.id),name:t.title,price:"".concat(t.presentment_price),quantity:t.quantity}})):(e=document.querySelectorAll("._rsi-modal-line-item"),Array.from(e).map((function(t,e){var n=t.querySelector("._rsi-modal-line-item-title").innerText,o=t.querySelector("._rsi-modal-line-item-final-price").innerText.replace(/[^0-9.,-]+/g,"");return t.querySelector("._rsi-modal-line-item-quantity").innerText,{id:t.attributes["data-line-item-variant-id"].value,name:n,price:o}})))},n=function(t,e,n,o){fetch("https://events-v2.adtrace.ai/event",{method:"POST",headers:{"Content-Type":"application/json","Shopify-Domain":window.Shopify.shop,"User-Agent":navigator.userAgent,"X-AdTrace-Origin":"theme-app-extension"},body:JSON.stringify({event_id:t,event_name:e,contents:Array.isArray(n)?n:[n],currency:o,event_context:{page:{url:window.location.href,referrer:document.referrer}},cookie:document.cookie})}).catch((function(t){console.error(t)}))},o=function(t){return"string"==typeof t&&t.includes(",")&&(t=","===t[t.length-3]?t.replace(".","").replace(",","."):t.replace(",","")),t},r=function(){var t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var o=16*Math.random();return t>0?(o=(t+o)%16|0,t=Math.floor(t/16)):(o=(e+o)%16|0,e=Math.floor(e/16)),("x"==n?o:7&o|8).toString(16)}))};function i(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var a="apps/rsi-cod-form-do-not-change/create-order",d=function(t,e,i,c){switch(t){case"ViewContent":!function(t,e,i){var c=r(),a=t.id,d=t.name,u=(t.description,t.image,{content_id:a,content_name:d,content_type:"product",content_description:"",content_image:"",price:o(t.price)});!function(t,e,n){if(window.ttq){var o={content_id:e.content_id,content_name:e.content_name,content_type:e.content_type,price:e.price,value:e.price,currency:n};ttq.track("ViewContent",o,{event_id:t})}}(c,u,e),i&&n(c,"ViewContent",u,e)}(e,i,c);break;case"AddToCart":!function(t,e,i){var c=r(),a=t.id,d=t.name,u=(t.description,t.image,{content_id:a,content_name:d,content_type:"product",content_description:"",content_image:"",price:o(t.price),quantity:1});!function(t,e,n){if(window.ttq){var o={content_id:e.content_id,content_name:e.content_name,content_type:e.content_type,price:e.price,value:e.price,currency:n};ttq.track("AddToCart",o,{event_id:t})}}(c,u,e),i&&n(c,"AddToCart",u,e)}(e,i,c);break;case"InitiateCheckout":!function(t,e,i){var c=r(),a=t.id,d=t.name,u=(t.description,t.image,{content_id:a,content_name:d,content_type:"product",content_description:"",content_image:"",price:o(t.price),quantity:1});!function(t,e,n){if(window.ttq){var o={contents:[{content_id:e.content_id,content_name:e.content_name,content_type:e.content_type,price:e.price,quantity:1}],value:e.price,currency:n};ttq.track("InitiateCheckout",o,{event_id:t})}}(c,u,e),i&&n(c,"InitiateCheckout",u,e)}(e,i,c);break;case"CompletePayment":!function(t,e,i){var c=r(),a=t.id,d=t.name,u=(t.description,t.image,{content_id:a,content_name:d,content_type:"product",content_description:"",content_image:"",price:o(t.price),quantity:1});console.log("send to tiktok"),function(t,e,n){if(console.log("windowttq",!!window.ttq),console.log(window),console.log(window.ttq),console.log(window._ttq),window.ttq){console.log("tracking");var o={contents:[{content_id:e.content_id,content_name:e.content_name,content_type:e.content_type,price:e.price,quantity:1}],value:e.price,currency:n};console.log("CompletePayment",o,{event_id:t}),window.ttq.track("CompletePayment",o,{event_id:t})}}(c,u,e),i&&n(c,"CompletePayment",u,e)}(e,i,c)}},u=function(t,n,o){!function(t,e,n){[].concat(i(document.querySelectorAll("#_rsi-buy-now-button")),i(document.querySelectorAll("#_rsi-buy-now-button-overwrite"))).forEach((function(o){o.addEventListener("click",(function(){d("InitiateCheckout",t,e,n)}))}))}(t,n,o),function(t,n,o){var r=window.fetch;window.fetch=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.call(window,t,i).then((function(r){if("string"==typeof t&&t.includes(a))try{console.log("Tracking CompletePayment");var i=e();d("CompletePayment",i[0],n,o)}catch(t){console.log(t)}return r}))}}(0,n,o),function(t,n,o){var r=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var t=this;this.addEventListener("load",(function(){if(t._url&&"string"==typeof t._url&&t._url.includes(a))try{console.log("Tracking CompletePayment");var r=e();d("CompletePayment",r[0],n,o)}catch(t){console.log(t)}}));for(var i=arguments.length,c=new Array(i),u=0;u<i;u++)c[u]=arguments[u];return r.apply(this,c)}}(0,n,o)};function l(){var e=window,n=(e.__adTraceIsProductPage,e.__adTraceProductInfo),o=e.__adTraceShopCurrency;if(e.__adTraceIsRsi){var r=0===window.adt_apps.indexOf("tiktok");t(),u(n,o,r)}}window&&!window.__adTraceTikTokPaused&&(console.log("TikTok Track"),window.adt_apps=window.adt_apps||[],window.adt_apps.push("tiktok"),window.__adTraceIsRsi="undefined"!=typeof _rsi,"loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())})();